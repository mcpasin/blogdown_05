<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Grand Slam Analysis - Marco Pasin - my new data blog</title>
  <link rel="alternate" hreflang="en" href="/" />

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Marco Pasin" />
  <meta name="description" content="setwd(&amp;quot;C:/Users/Marco/Dropbox/Rprojects/tidytuesdays/grand_slams_09042019&amp;quot;)Load libraries
library(tidyverse)## Warning: package &amp;#39;tidyverse&amp;#39; was built under R version 3.4.3## -- Attaching packages ---------------------------- tidyverse 1.2.1 --## v ggplot2 3.0.0 v purrr 0.2.4## v tibble 1.4.2 v dplyr 0.7.4## v tidyr 0.8.0 v stringr 1.3.0## v readr 1.1.1 v forcats 0.3.0## Warning: package &amp;#39;ggplot2&amp;#39; was built under R version 3.4.4## Warning: package &amp;#39;tibble&amp;#39; was built under R version 3.4.3## Warning: package &amp;#39;tidyr&amp;#39; was built under R version 3." />

  <meta name="keywords" content="blog, mcpasin, marco" />






<meta name="generator" content="Hugo 0.37.1" />


<link rel="canonical" href="/post/grand_slams/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" href="/favicon.ico" />
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="Grand Slam Analysis" />
<meta property="og:description" content="setwd(&quot;C:/Users/Marco/Dropbox/Rprojects/tidytuesdays/grand_slams_09042019&quot;)Load libraries
library(tidyverse)## Warning: package &#39;tidyverse&#39; was built under R version 3.4.3## -- Attaching packages ---------------------------- tidyverse 1.2.1 --## v ggplot2 3.0.0 v purrr 0.2.4## v tibble 1.4.2 v dplyr 0.7.4## v tidyr 0.8.0 v stringr 1.3.0## v readr 1.1.1 v forcats 0.3.0## Warning: package &#39;ggplot2&#39; was built under R version 3.4.4## Warning: package &#39;tibble&#39; was built under R version 3.4.3## Warning: package &#39;tidyr&#39; was built under R version 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/grand_slams/" />
















<meta itemprop="name" content="Grand Slam Analysis">
<meta itemprop="description" content="setwd(&quot;C:/Users/Marco/Dropbox/Rprojects/tidytuesdays/grand_slams_09042019&quot;)Load libraries
library(tidyverse)## Warning: package &#39;tidyverse&#39; was built under R version 3.4.3## -- Attaching packages ---------------------------- tidyverse 1.2.1 --## v ggplot2 3.0.0 v purrr 0.2.4## v tibble 1.4.2 v dplyr 0.7.4## v tidyr 0.8.0 v stringr 1.3.0## v readr 1.1.1 v forcats 0.3.0## Warning: package &#39;ggplot2&#39; was built under R version 3.4.4## Warning: package &#39;tibble&#39; was built under R version 3.4.3## Warning: package &#39;tidyr&#39; was built under R version 3.">



<meta itemprop="wordCount" content="3416">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Grand Slam Analysis"/>
<meta name="twitter:description" content="setwd(&quot;C:/Users/Marco/Dropbox/Rprojects/tidytuesdays/grand_slams_09042019&quot;)Load libraries
library(tidyverse)## Warning: package &#39;tidyverse&#39; was built under R version 3.4.3## -- Attaching packages ---------------------------- tidyverse 1.2.1 --## v ggplot2 3.0.0 v purrr 0.2.4## v tibble 1.4.2 v dplyr 0.7.4## v tidyr 0.8.0 v stringr 1.3.0## v readr 1.1.1 v forcats 0.3.0## Warning: package &#39;ggplot2&#39; was built under R version 3.4.4## Warning: package &#39;tibble&#39; was built under R version 3.4.3## Warning: package &#39;tidyr&#39; was built under R version 3."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-31499810-9', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Marco Pasin</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Posts</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About me</li>
      </a><a href="/portfolio/">
        <li class="mobile-menu-item">Portfolio</li>
      </a>
  </ul>
</nav>

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">Marco Pasin</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Posts</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About me</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/portfolio/">Portfolio</a>
      </li>
  </ul>
</nav>
  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Grand Slam Analysis</h1>

      <div class="post-meta">
        <span class="post-time"> 0001-01-01 </span>
        
        <span class="more-meta"> 3416 words </span>
        <span class="more-meta"> 17 min read </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  
  <div class="post-toc-content always-active">
    
  </div>
</div>

    
    <div class="post-content">
      <pre class="r"><code>setwd(&quot;C:/Users/Marco/Dropbox/Rprojects/tidytuesdays/grand_slams_09042019&quot;)</code></pre>
<p>Load libraries</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Warning: package &#39;tidyverse&#39; was built under R version 3.4.3</code></pre>
<pre><code>## -- Attaching packages ---------------------------- tidyverse 1.2.1 --</code></pre>
<pre><code>## v ggplot2 3.0.0     v purrr   0.2.4
## v tibble  1.4.2     v dplyr   0.7.4
## v tidyr   0.8.0     v stringr 1.3.0
## v readr   1.1.1     v forcats 0.3.0</code></pre>
<pre><code>## Warning: package &#39;ggplot2&#39; was built under R version 3.4.4</code></pre>
<pre><code>## Warning: package &#39;tibble&#39; was built under R version 3.4.3</code></pre>
<pre><code>## Warning: package &#39;tidyr&#39; was built under R version 3.4.3</code></pre>
<pre><code>## Warning: package &#39;readr&#39; was built under R version 3.4.3</code></pre>
<pre><code>## Warning: package &#39;purrr&#39; was built under R version 3.4.3</code></pre>
<pre><code>## Warning: package &#39;dplyr&#39; was built under R version 3.4.3</code></pre>
<pre><code>## Warning: package &#39;stringr&#39; was built under R version 3.4.3</code></pre>
<pre><code>## Warning: package &#39;forcats&#39; was built under R version 3.4.3</code></pre>
<pre><code>## -- Conflicts ------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(gganimate)</code></pre>
<pre><code>## Warning: package &#39;gganimate&#39; was built under R version 3.4.4</code></pre>
<div id="read-in-datasets" class="section level3">
<h3>Read in datasets</h3>
<pre class="r"><code>player_dob &lt;- readr::read_csv(&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-04-09/player_dob.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   name = col_character(),
##   grand_slam = col_character(),
##   date_of_birth = col_date(format = &quot;&quot;),
##   date_of_first_title = col_date(format = &quot;&quot;),
##   age = col_integer()
## )</code></pre>
<pre class="r"><code>grand_slams &lt;- readr::read_csv(&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-04-09/grand_slams.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   year = col_integer(),
##   grand_slam = col_character(),
##   name = col_character(),
##   rolling_win_count = col_integer(),
##   tournament_date = col_date(format = &quot;&quot;),
##   gender = col_character()
## )</code></pre>
<pre class="r"><code>grand_slam_timeline &lt;- readr::read_csv(&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-04-09/grand_slam_timeline.csv&quot;)</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   player = col_character(),
##   year = col_integer(),
##   tournament = col_character(),
##   outcome = col_character(),
##   gender = col_character()
## )</code></pre>
<p>After a quick look at the files, I am going to focus on <strong>grand_slams</strong> dataset, which contains the tennis players winners for each Grand Slam tournament since 1968.</p>
<pre class="r"><code>grand_slams</code></pre>
<pre><code>## # A tibble: 416 x 6
##     year grand_slam      name      rolling_win_cou~ tournament_date gender
##    &lt;int&gt; &lt;chr&gt;           &lt;chr&gt;                &lt;int&gt; &lt;date&gt;          &lt;chr&gt; 
##  1  1968 australian_open Billie J~                1 1968-01-10      Female
##  2  1968 french_open     Nancy Ri~                1 1968-06-09      Female
##  3  1968 wimbledon       Billie J~                2 1968-07-14      Female
##  4  1968 us_open         Virginia~                1 1968-09-09      Female
##  5  1969 australian_open Margaret~                1 1969-01-10      Female
##  6  1969 french_open     Margaret~                2 1969-06-09      Female
##  7  1969 wimbledon       Ann Hayd~                1 1969-07-14      Female
##  8  1969 us_open         Margaret~                3 1969-09-09      Female
##  9  1970 australian_open Margaret~                4 1970-01-10      Female
## 10  1970 french_open     Margaret~                5 1970-06-09      Female
## # ... with 406 more rows</code></pre>
<pre class="r"><code>grand_slams %&gt;% 
  #group_by(gender) %&gt;% 
  filter(gender==&quot;Male&quot;) %&gt;% 
  count(name, sort=TRUE)</code></pre>
<pre><code>## Warning: package &#39;bindrcpp&#39; was built under R version 3.4.3</code></pre>
<pre><code>## Warning: `as_dictionary()` is soft-deprecated as of rlang 0.3.0.
## Please use `as_data_pronoun()` instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `new_overscope()` is soft-deprecated as of rlang 0.2.0.
## Please use `new_data_mask()` instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: The `parent` argument of `new_data_mask()` is deprecated.
## The parent of the data mask is determined from either:
## 
##   * The `env` argument of `eval_tidy()`
##   * Quosure environments when applicable
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `overscope_clean()` is soft-deprecated as of rlang 0.2.0.
## This warning is displayed once per session.</code></pre>
<pre><code>## # A tibble: 55 x 2
##    name               n
##    &lt;chr&gt;          &lt;int&gt;
##  1 Roger Federer     20
##  2 Rafael Nadal      17
##  3 Novak Djokovic    15
##  4 Pete Sampras      14
##  5 Björn Borg        12
##  6 Andre Agassi       8
##  7 Ivan Lendl         8
##  8 Jimmy Connors      8
##  9 John McEnroe       7
## 10 Mats Wilander      7
## # ... with 45 more rows</code></pre>
<p><br/></p>
</div>
<div id="prepare-data" class="section level3">
<h3>Prepare data</h3>
<p>What I want to build it’s an animation showing how the winners ranking has been changing over the years, since the first tournament until now (most recent data available is from 2019). So, I don’t need the exact date but actually just the year.</p>
<p>As the names indicates, <code>rolling_win_count</code> column is a rolling count of tournament won for each player. For example, Margaret Count won 2 tournaments in the same year in 1969, and her rollin count on the last tournament is 2. So, the first step to get the dataset tidy on a year level, is to get the maximum count for each year.</p>
<pre class="r"><code>win_per_year &lt;- grand_slams %&gt;%
  group_by(year, name, gender) %&gt;% 
  summarize(win_count = max(rolling_win_count))

win_per_year</code></pre>
<pre><code>## # A tibble: 308 x 4
## # Groups:   year, name [?]
##     year name             gender win_count
##    &lt;int&gt; &lt;chr&gt;            &lt;chr&gt;      &lt;dbl&gt;
##  1  1968 Arthur Ashe      Male        1.00
##  2  1968 Billie Jean King Female      2.00
##  3  1968 Ken Rosewall     Male        1.00
##  4  1968 Nancy Richey     Female      1.00
##  5  1968 Rod Laver        Male        1.00
##  6  1968 Virginia Wade    Female      1.00
##  7  1968 William Bowrey   Male        1.00
##  8  1969 Ann Haydon-Jones Female      1.00
##  9  1969 Margaret Court   Female      3.00
## 10  1969 Rod Laver        Male        5.00
## # ... with 298 more rows</code></pre>
<p><br/></p>
<p>Almost there. Margaret Curt won some tournaments in 1969, 1970, 1971 and 1973 was the last one. But she didn’t win anything on 1972 and after 1973, so we don’t have any more observations indicating what her current ranking was for eample in 1980 or even this year.</p>
<p>Next step in data preparation is, for each player, to create a row for each year he/she didn’t win and fill it with his/her previous win rolling count. I can do this with these 3 steps:</p>
<ol style="list-style-type: decimal">
<li>For each player create a vector of complete years between their first win and now (I’ll use a for loop for this)</li>
<li>Merge it back with the original grand slam dataset (a left_join will return null values where it doesn’t find a value for the win_rolling_count variable)</li>
<li>Impute null values with the immediate previous available win_rolling_count (I use the <code>fill</code> function)</li>
</ol>
<pre class="r"><code># Get max year available in the dataset
max_year &lt;- max(grand_slams$year)

##Test it on a smaller subset e.g.:
smaller_subset &lt;- win_per_year %&gt;%
  filter(str_detect(name, &quot;Federer|del Potro|Williams|Court&quot;))
players_subset &lt;- smaller_subset

#players_subset &lt;- win_per_year # I am taking all players!

# Get min year for each player (that is year of first tournament won)
player_min_year &lt;- players_subset %&gt;% 
  group_by(name) %&gt;%
  summarise(min_year = min(year))

# Initialize an empty dataframe to be used to store data in for loop
tmp_df &lt;- data.frame()

for (i in player_min_year$name) {
  print(i)

  min_year &lt;- player_min_year %&gt;% 
    filter(name == i) %&gt;%
    select(min_year) %&gt;%
    pull()
  
  # create vector of complete years between his/her first win and now
  complete_dates &lt;- seq(min_year, max_year)
  
  # for each player, create dataframe with a row for each year between his/her first win and now
  complete_df &lt;- data.frame(name = i, year = complete_dates)
  print(complete_df)
  
  # concatenate current player dataframe to previous one
  tmp_df &lt;- tmp_df %&gt;%
    bind_rows(complete_df)

}</code></pre>
<pre><code>## [1] &quot;Juan Martín del Potro&quot;
##                     name year
## 1  Juan Martín del Potro 2009
## 2  Juan Martín del Potro 2010
## 3  Juan Martín del Potro 2011
## 4  Juan Martín del Potro 2012
## 5  Juan Martín del Potro 2013
## 6  Juan Martín del Potro 2014
## 7  Juan Martín del Potro 2015
## 8  Juan Martín del Potro 2016
## 9  Juan Martín del Potro 2017
## 10 Juan Martín del Potro 2018
## 11 Juan Martín del Potro 2019
## [1] &quot;Margaret Court&quot;
##              name year
## 1  Margaret Court 1969
## 2  Margaret Court 1970
## 3  Margaret Court 1971
## 4  Margaret Court 1972
## 5  Margaret Court 1973
## 6  Margaret Court 1974
## 7  Margaret Court 1975
## 8  Margaret Court 1976
## 9  Margaret Court 1977
## 10 Margaret Court 1978
## 11 Margaret Court 1979
## 12 Margaret Court 1980
## 13 Margaret Court 1981
## 14 Margaret Court 1982
## 15 Margaret Court 1983
## 16 Margaret Court 1984
## 17 Margaret Court 1985
## 18 Margaret Court 1986
## 19 Margaret Court 1987
## 20 Margaret Court 1988
## 21 Margaret Court 1989
## 22 Margaret Court 1990
## 23 Margaret Court 1991
## 24 Margaret Court 1992
## 25 Margaret Court 1993
## 26 Margaret Court 1994
## 27 Margaret Court 1995
## 28 Margaret Court 1996
## 29 Margaret Court 1997
## 30 Margaret Court 1998
## 31 Margaret Court 1999
## 32 Margaret Court 2000
## 33 Margaret Court 2001
## 34 Margaret Court 2002
## 35 Margaret Court 2003
## 36 Margaret Court 2004
## 37 Margaret Court 2005
## 38 Margaret Court 2006
## 39 Margaret Court 2007
## 40 Margaret Court 2008
## 41 Margaret Court 2009
## 42 Margaret Court 2010
## 43 Margaret Court 2011
## 44 Margaret Court 2012
## 45 Margaret Court 2013
## 46 Margaret Court 2014
## 47 Margaret Court 2015
## 48 Margaret Court 2016
## 49 Margaret Court 2017
## 50 Margaret Court 2018
## 51 Margaret Court 2019</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): Unequal factor levels: coercing to character</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector

## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector</code></pre>
<pre><code>## [1] &quot;Roger Federer&quot;
##             name year
## 1  Roger Federer 2003
## 2  Roger Federer 2004
## 3  Roger Federer 2005
## 4  Roger Federer 2006
## 5  Roger Federer 2007
## 6  Roger Federer 2008
## 7  Roger Federer 2009
## 8  Roger Federer 2010
## 9  Roger Federer 2011
## 10 Roger Federer 2012
## 11 Roger Federer 2013
## 12 Roger Federer 2014
## 13 Roger Federer 2015
## 14 Roger Federer 2016
## 15 Roger Federer 2017
## 16 Roger Federer 2018
## 17 Roger Federer 2019</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector</code></pre>
<pre><code>## [1] &quot;Serena Williams&quot;
##               name year
## 1  Serena Williams 1999
## 2  Serena Williams 2000
## 3  Serena Williams 2001
## 4  Serena Williams 2002
## 5  Serena Williams 2003
## 6  Serena Williams 2004
## 7  Serena Williams 2005
## 8  Serena Williams 2006
## 9  Serena Williams 2007
## 10 Serena Williams 2008
## 11 Serena Williams 2009
## 12 Serena Williams 2010
## 13 Serena Williams 2011
## 14 Serena Williams 2012
## 15 Serena Williams 2013
## 16 Serena Williams 2014
## 17 Serena Williams 2015
## 18 Serena Williams 2016
## 19 Serena Williams 2017
## 20 Serena Williams 2018
## 21 Serena Williams 2019</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector</code></pre>
<pre><code>## [1] &quot;Venus Williams&quot;
##              name year
## 1  Venus Williams 2000
## 2  Venus Williams 2001
## 3  Venus Williams 2002
## 4  Venus Williams 2003
## 5  Venus Williams 2004
## 6  Venus Williams 2005
## 7  Venus Williams 2006
## 8  Venus Williams 2007
## 9  Venus Williams 2008
## 10 Venus Williams 2009
## 11 Venus Williams 2010
## 12 Venus Williams 2011
## 13 Venus Williams 2012
## 14 Venus Williams 2013
## 15 Venus Williams 2014
## 16 Venus Williams 2015
## 17 Venus Williams 2016
## 18 Venus Williams 2017
## 19 Venus Williams 2018
## 20 Venus Williams 2019</code></pre>
<pre><code>## Warning in bind_rows_(x, .id): binding character and factor vector,
## coercing into character vector</code></pre>
<pre class="r"><code># Left join player complete years dataframe with grand slam
merged_df &lt;- tmp_df %&gt;% 
  left_join(players_subset, by=c(&quot;name&quot;, &quot;year&quot;))

# Fill in NAs with previous values
merged_df_filled &lt;- merged_df %&gt;% fill(win_count, gender)</code></pre>
<pre class="r"><code>merged_df_filled</code></pre>
<pre><code>##                      name year gender win_count
## 1   Juan Martín del Potro 2009   Male         1
## 2   Juan Martín del Potro 2010   Male         1
## 3   Juan Martín del Potro 2011   Male         1
## 4   Juan Martín del Potro 2012   Male         1
## 5   Juan Martín del Potro 2013   Male         1
## 6   Juan Martín del Potro 2014   Male         1
## 7   Juan Martín del Potro 2015   Male         1
## 8   Juan Martín del Potro 2016   Male         1
## 9   Juan Martín del Potro 2017   Male         1
## 10  Juan Martín del Potro 2018   Male         1
## 11  Juan Martín del Potro 2019   Male         1
## 12         Margaret Court 1969 Female         3
## 13         Margaret Court 1970 Female         7
## 14         Margaret Court 1971 Female         8
## 15         Margaret Court 1972 Female         8
## 16         Margaret Court 1973 Female        11
## 17         Margaret Court 1974 Female        11
## 18         Margaret Court 1975 Female        11
## 19         Margaret Court 1976 Female        11
## 20         Margaret Court 1977 Female        11
## 21         Margaret Court 1978 Female        11
## 22         Margaret Court 1979 Female        11
## 23         Margaret Court 1980 Female        11
## 24         Margaret Court 1981 Female        11
## 25         Margaret Court 1982 Female        11
## 26         Margaret Court 1983 Female        11
## 27         Margaret Court 1984 Female        11
## 28         Margaret Court 1985 Female        11
## 29         Margaret Court 1986 Female        11
## 30         Margaret Court 1987 Female        11
## 31         Margaret Court 1988 Female        11
## 32         Margaret Court 1989 Female        11
## 33         Margaret Court 1990 Female        11
## 34         Margaret Court 1991 Female        11
## 35         Margaret Court 1992 Female        11
## 36         Margaret Court 1993 Female        11
## 37         Margaret Court 1994 Female        11
## 38         Margaret Court 1995 Female        11
## 39         Margaret Court 1996 Female        11
## 40         Margaret Court 1997 Female        11
## 41         Margaret Court 1998 Female        11
## 42         Margaret Court 1999 Female        11
## 43         Margaret Court 2000 Female        11
## 44         Margaret Court 2001 Female        11
## 45         Margaret Court 2002 Female        11
## 46         Margaret Court 2003 Female        11
## 47         Margaret Court 2004 Female        11
## 48         Margaret Court 2005 Female        11
## 49         Margaret Court 2006 Female        11
## 50         Margaret Court 2007 Female        11
## 51         Margaret Court 2008 Female        11
## 52         Margaret Court 2009 Female        11
## 53         Margaret Court 2010 Female        11
## 54         Margaret Court 2011 Female        11
## 55         Margaret Court 2012 Female        11
## 56         Margaret Court 2013 Female        11
## 57         Margaret Court 2014 Female        11
## 58         Margaret Court 2015 Female        11
## 59         Margaret Court 2016 Female        11
## 60         Margaret Court 2017 Female        11
## 61         Margaret Court 2018 Female        11
## 62         Margaret Court 2019 Female        11
## 63          Roger Federer 2003   Male         1
## 64          Roger Federer 2004   Male         4
## 65          Roger Federer 2005   Male         6
## 66          Roger Federer 2006   Male         9
## 67          Roger Federer 2007   Male        12
## 68          Roger Federer 2008   Male        13
## 69          Roger Federer 2009   Male        15
## 70          Roger Federer 2010   Male        16
## 71          Roger Federer 2011   Male        16
## 72          Roger Federer 2012   Male        17
## 73          Roger Federer 2013   Male        17
## 74          Roger Federer 2014   Male        17
## 75          Roger Federer 2015   Male        17
## 76          Roger Federer 2016   Male        17
## 77          Roger Federer 2017   Male        19
## 78          Roger Federer 2018   Male        20
## 79          Roger Federer 2019   Male        20
## 80        Serena Williams 1999 Female         1
## 81        Serena Williams 2000 Female         1
## 82        Serena Williams 2001 Female         1
## 83        Serena Williams 2002 Female         4
## 84        Serena Williams 2003 Female         6
## 85        Serena Williams 2004 Female         6
## 86        Serena Williams 2005 Female         7
## 87        Serena Williams 2006 Female         7
## 88        Serena Williams 2007 Female         8
## 89        Serena Williams 2008 Female         9
## 90        Serena Williams 2009 Female        11
## 91        Serena Williams 2010 Female        13
## 92        Serena Williams 2011 Female        13
## 93        Serena Williams 2012 Female        15
## 94        Serena Williams 2013 Female        17
## 95        Serena Williams 2014 Female        18
## 96        Serena Williams 2015 Female        21
## 97        Serena Williams 2016 Female        22
## 98        Serena Williams 2017 Female        23
## 99        Serena Williams 2018 Female        23
## 100       Serena Williams 2019 Female        23
## 101        Venus Williams 2000 Female         2
## 102        Venus Williams 2001 Female         4
## 103        Venus Williams 2002 Female         4
## 104        Venus Williams 2003 Female         4
## 105        Venus Williams 2004 Female         4
## 106        Venus Williams 2005 Female         5
## 107        Venus Williams 2006 Female         5
## 108        Venus Williams 2007 Female         6
## 109        Venus Williams 2008 Female         7
## 110        Venus Williams 2009 Female         7
## 111        Venus Williams 2010 Female         7
## 112        Venus Williams 2011 Female         7
## 113        Venus Williams 2012 Female         7
## 114        Venus Williams 2013 Female         7
## 115        Venus Williams 2014 Female         7
## 116        Venus Williams 2015 Female         7
## 117        Venus Williams 2016 Female         7
## 118        Venus Williams 2017 Female         7
## 119        Venus Williams 2018 Female         7
## 120        Venus Williams 2019 Female         7</code></pre>
<p><br/></p>
<p>Cool! We have now a dataset prepared for creating the visualization :)</p>
<p><br/></p>
</div>
<div id="creating-the-animation" class="section level3">
<h3>Creating the animation</h3>
<p>Creating an animation with <code>gganimate</code> package is pretty easy, there are a couple of very nice examples you can check. Where I’ve been struggling for this specific visualization was to keep the bars propertly sorted throughout time and and make them overtaking each others. Luckily this <a href="https://stackoverflow.com/questions/53162821/animated-sorted-bar-chart-with-bars-overtaking-each-other">Stackoverflow answer</a> helped me a lot.</p>
<p>I still need to spend more time going through the gganimate documentation and try adjusting more parameters. However, the code below did a good job so far and I am pretty happy for now!</p>
<pre class="r"><code>df1 &lt;- merged_df_filled %&gt;% 
  #filter(year &gt;=2015) %&gt;% 
  filter(gender==&quot;Male&quot;) %&gt;%
  ungroup() %&gt;% 
  group_by(year) %&gt;% 
  mutate(rank = row_number(-win_count)*1) #this is key to mantain the sorting

slam_theme &lt;- theme(
  plot.title = element_text(hjust = 0, size = 22, face = &#39;bold&#39;),
  plot.subtitle = element_text(hjust = 0, size = 16),
  axis.ticks.y = element_blank(), # after flip
  axis.text.y  = element_blank(), # after flip
  panel.grid.major.y = element_blank(),
  panel.grid.minor.y = element_blank(),
  plot.margin = margin(1, 1, 1, 4, &quot;cm&quot;),
  panel.background = element_rect(fill = &quot;#E0E0FF&quot;, colour = NA),
  plot.background = element_rect(fill = &quot;#E0E0FF&quot;, colour = NA)
  ) #DEE7D7

theme_set(theme_bw() + slam_theme)

# Create animation object
p &lt;- ggplot(df1, aes(rank, group = name, fill = as.factor(name), 
                     color = as.factor(name))) +
  geom_tile(aes(y = win_count/2,
                height = win_count,
                width = 0.9), alpha = 0.8, color = NA) +
  geom_text(aes(y = 0, label = paste(name, &quot; &quot;)), vjust = 0.2, hjust = 1) +
  geom_text(aes(y = win_count, label = as.factor(win_count)), nudge_y = 0.2) +

  coord_flip(clip = &quot;off&quot;, expand = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_reverse() +
  guides(color = FALSE, fill = FALSE) +

  labs(title=&#39;Grand Slam male titles ranking: how changed over time&#39;,
       subtitle =&quot;Year: {closest_state}&quot;,
       x = &quot;&quot;, 
       y = &quot;titles won&quot;) +

  transition_states(year, transition_length = 4, state_length = 3) +
  ease_aes(&#39;cubic-in-out&#39;)

# Render animation object and set parameters
animate(p, fps = 20, duration = 35, width = 800, height = 600, detail = 2)</code></pre>
<p><br/></p>
</div>
<div id="save-animation-as-gif-file" class="section level3">
<h3>Save animation as gif file</h3>
<pre class="r"><code>library(magick)

image &lt;- animate(p, fps = 25, duration = 35, width = 800, height = 600)
image_write(image, &#39;grand_slam_ranking.gif&#39;)

anim_save(&quot;gs_male_ranking.gif&quot;, image)</code></pre>
<p><br/></p>
<div id="bonus-faceting-the-animation" class="section level4">
<h4>Bonus: Faceting the animation</h4>
<p>Here I want to <strong>include both genders</strong> in the visualization by using one facet for males and the other for females. I am going to make a few adjustments on the viz in order to accomodate two facets and keep the visualization neat:<br />
- remove colours for players and use just two colours: pink for females and blue fo men - add more space between the two facets</p>
<pre class="r"><code>df1 &lt;- merged_df_filled %&gt;% 
  filter(year &gt;=2005) %&gt;% 
  #filter(gender==&quot;Male&quot;) %&gt;%
  ungroup() %&gt;% 
  group_by(gender, year) %&gt;% 
  mutate(rank = row_number(-win_count)*1) 

slam_theme &lt;- theme(
  plot.title = element_text(hjust = 0, size = 22, face = &#39;bold&#39;),
  plot.subtitle = element_text(hjust = 0, size = 16),
  axis.ticks.y = element_blank(), # after flip
  axis.text.y  = element_blank(), # after flip
  panel.grid.major.y = element_blank(),
  panel.grid.minor.y = element_blank(),
  plot.margin = margin(1, 1, 1, 4, &quot;cm&quot;),
  panel.background = element_rect(fill = &quot;#E0E0FF&quot;, colour = NA),
  plot.background = element_rect(fill = &quot;#E0E0FF&quot;, colour = NA)
  ) #DEE7D7

theme_set(theme_bw() + slam_theme)

# Create animation object
p &lt;- ggplot(df1, aes(rank, group = name, 
                     fill = as.factor(gender), color = as.factor(gender))) +
  geom_tile(aes(y = win_count/2,
                height = win_count,
                width = 0.9), alpha = 0.8, color = NA) +
  geom_text(aes(y = 0, label = paste(name, &quot; &quot;)), vjust = 0.2, hjust = 1) +
  #geom_text(aes(y = win_count, label = name), nudge_y = -3) +
  geom_text(aes(y = win_count, label = as.character(win_count)), nudge_y = 0.5) +

  coord_flip(clip = &quot;off&quot;, expand = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  scale_x_reverse() +
  guides(color = FALSE, fill = FALSE) +
  
  facet_wrap(~gender) +
  scale_fill_manual(values = c(&quot;#B775B4&quot;, &quot;#3b7db5&quot;)) +
  theme(panel.spacing = unit(8, &quot;lines&quot;)) +

  labs(title=&#39;Grand Slam titles ranking by gender: how changed over time&#39;,
       subtitle =&quot;Year: {closest_state}&quot;,
       x = &quot;&quot;, 
       y = &quot;titles won&quot;) +

  transition_states(year, transition_length = 4, state_length = 3) +
  ease_aes(&#39;cubic-in-out&#39;)

# Render animation object and set parameters
animate(p, fps = 20, duration = 35, width = 800, height = 600, detail = 2)</code></pre>
</div>
</div>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Marco Pasin</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">0001-01-01</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    

    <footer class="post-footer">
      

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/shortcodes-preview.utf8/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Shortcodes Preview</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
      </nav>
    </footer>
    

  

  

  <div id="comments-gitment"></div>
  <link rel="stylesheet" href="/lib/gitment/gitment-0.0.3.min.css">
    <script src="/lib/gitment/gitment-0.0.3.min.js"></script>
  <script type="text/javascript">
  const gitment = new Gitment({
    id: '0001-01-01 00:00:00 \x2b0000 UTC',
    title: 'Grand Slam Analysis',
    link: decodeURI(location.href),
    desc: 'setwd(\x26quot;C:\/Users\/Marco\/Dropbox\/Rprojects\/tidytuesdays\/grand_slams_09042019\x26quot;)\rLoad libraries\nlibrary(tidyverse)\r## Warning: package \x26#39;tidyverse\x26#39; was built under R version 3.4.3\r## -- Attaching packages ---------------------------- tidyverse 1.2.1 --\r## v ggplot2 3.0.0 v purrr 0.2.4\r## v tibble 1.4.2 v dplyr 0.7.4\r## v tidyr 0.8.0 v stringr 1.3.0\r## v readr 1.1.1 v forcats 0.3.0\r## Warning: package \x26#39;ggplot2\x26#39; was built under R version 3.4.4\r## Warning: package \x26#39;tibble\x26#39; was built under R version 3.4.3\r## Warning: package \x26#39;tidyr\x26#39; was built under R version 3.',
    owner: 'mcpasin',
    repo: 'https:\/\/github.com\/mcpasin\/blogdown_05',
    oauth: {
      client_id: '',
      client_secret: ''
    }
  })
  gitment.render('comments-gitment')
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>
  </article>
        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://www.linkedin.com/in/marcopasin/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://twitter.com/mcpasin" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/mcpasin" class="iconfont icon-github" title="github"></a>
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy; 
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Marco Pasin</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>





</body>
</html>
